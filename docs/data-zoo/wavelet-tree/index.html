<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=https://memoria-framework.dev/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://memoria-framework.dev/fonts/vendor/jost/jost-v4-latin-500.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://memoria-framework.dev/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://memoria-framework.dev/fonts/KaTeX_Main-Regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://memoria-framework.dev/fonts/KaTeX_Math-Italic.woff2 type=font/woff2 crossorigin><link rel=stylesheet href=https://memoria-framework.dev/main.936beb930fd98ad42e9ffeb326821156010eee32296e56a34ddbc6be19fe80fa939278f5ca78e22e25b3e3a8808e25f8050913e6a9c92db586b3d82e09e3d179.css integrity="sha512-k2vrkw/ZitQun/6zJoIRVgEO7jIpblajTdvGvhn+gPqTknj1ynjiLiWz46iAjiX4BQkT5qnJLbWGs9guCePReQ==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Multiary Wavelet Trees - Memoria</title><meta name=description content="Wavelet trees (WT) are data succinct rank/select dictionaries for large alphabets with many practical applications. There is a good explanation of what binary wavelet trees are and how they work. They provide rank() and select() over symbol sequences ($N$ symbols) drawn from arbitrary fixed-size alphabets ($K$ symbols) in $O(log(N) * log(K))$ operations, where logarithms are on the base of 2. Therefore, for large alphabets, $log(K)$ is quite a big value that leads to big hidden constants in practical implementations of the binary WT."><link rel=canonical href=https://memoria-framework.dev/docs/data-zoo/wavelet-tree/><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="Multiary Wavelet Trees"><meta property="og:description" content="Wavelet trees (WT) are data succinct rank/select dictionaries for large alphabets with many practical applications. There is a good explanation of what binary wavelet trees are and how they work. They provide rank() and select() over symbol sequences ($N$ symbols) drawn from arbitrary fixed-size alphabets ($K$ symbols) in $O(log(N) * log(K))$ operations, where logarithms are on the base of 2. Therefore, for large alphabets, $log(K)$ is quite a big value that leads to big hidden constants in practical implementations of the binary WT."><meta property="og:url" content="https://memoria-framework.dev/docs/data-zoo/wavelet-tree/"><meta property="og:site_name" content="Memoria"><meta property="article:published_time" content="2021-10-28T02:07:01-04:00"><meta property="article:modified_time" content="2021-10-28T02:07:01-04:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content><meta name=twitter:creator content><meta name=twitter:title content="Multiary Wavelet Trees"><meta name=twitter:description content><meta name=twitter:card content="summary"><meta name=twitter:image:alt content="Multiary Wavelet Trees"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"Person","@id":"https://memoria-framework.dev/#/schema/person/1","name":"Memoria","url":"https://memoria-framework.dev/","sameAs":[],"image":{"@type":"ImageObject","@id":"https://memoria-framework.dev/#/schema/image/1","url":"https://memoria-framework.dev/\u003cnil\u003e","width":null,"height":null,"caption":"Memoria"}},{"@type":"WebSite","@id":"https://memoria-framework.dev/#/schema/website/1","url":"https://memoria-framework.dev/","name":"Memoria","description":"","publisher":{"@id":"https://memoria-framework.dev/#/schema/person/1"}},{"@type":"WebPage","@id":"https://memoria-framework.dev/docs/data-zoo/wavelet-tree/","url":"https://memoria-framework.dev/docs/data-zoo/wavelet-tree/","name":"Multiary Wavelet Trees","description":"","isPartOf":{"@id":"https://memoria-framework.dev/#/schema/website/1"},"about":{"@id":"https://memoria-framework.dev/#/schema/person/1"},"datePublished":"2021-10-28T02:07:01CET","dateModified":"2021-10-28T02:07:01CET","breadcrumb":{"@id":"https://memoria-framework.dev/docs/data-zoo/wavelet-tree/#/schema/breadcrumb/1"},"primaryImageOfPage":{"@id":"https://memoria-framework.dev/docs/data-zoo/wavelet-tree/#/schema/image/2"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://memoria-framework.dev/docs/data-zoo/wavelet-tree/"]}]},{"@type":"BreadcrumbList","@id":"https://memoria-framework.dev/docs/data-zoo/wavelet-tree/#/schema/breadcrumb/1","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://memoria-framework.dev/","url":"https://memoria-framework.dev/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@type":"WebPage","@id":"https://memoria-framework.dev/docs/","url":"https://memoria-framework.dev/docs/","name":"Docs"}},{"@type":"ListItem","position":3,"item":{"@type":"WebPage","@id":"https://memoria-framework.dev/docs/data-zoo/","url":"https://memoria-framework.dev/docs/data-zoo/","name":"Data Zoo"}},{"@type":"ListItem","position":4,"item":{"@id":"https://memoria-framework.dev/docs/data-zoo/wavelet-tree/"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Article","@id":"https://memoria-framework.dev/#/schema/article/1","headline":"Multiary Wavelet Trees","description":"","isPartOf":{"@id":"https://memoria-framework.dev/docs/data-zoo/wavelet-tree/"},"mainEntityOfPage":{"@id":"https://memoria-framework.dev/docs/data-zoo/wavelet-tree/"},"datePublished":"2021-10-28T02:07:01CET","dateModified":"2021-10-28T02:07:01CET","author":{"@id":"https://memoria-framework.dev/#/schema/person/2"},"publisher":{"@id":"https://memoria-framework.dev/#/schema/person/1"},"image":{"@id":"https://memoria-framework.dev/docs/data-zoo/wavelet-tree/#/schema/image/2"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Person","@id":"https://memoria-framework.dev/#/schema/person/2","name":"Victor Smirnov","sameAs":[]}]},{"@context":"https://schema.org","@graph":[{"@type":"ImageObject","@id":"https://memoria-framework.dev/docs/data-zoo/wavelet-tree/#/schema/image/2","url":null,"contentUrl":null,"caption":"Multiary Wavelet Trees"}]}]}</script><meta name=theme-color content="#fff"><link rel=icon href=https://memoria-framework.dev/favicon.ico sizes=any><link rel=apple-touch-icon sizes=180x180 href=https://memoria-framework.dev/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://memoria-framework.dev/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://memoria-framework.dev/favicon-16x16.png><link rel=manifest crossorigin=use-credentials href=https://memoria-framework.dev/site.webmanifest></head><body class="docs single"><div class=header-bar></div><header class="navbar navbar-expand-lg navbar-light doks-navbar"><nav class="container-xxl flex-wrap flex-lg-nowrap" aria-label="Main navigation"><a class="navbar-brand order-0" href=/ aria-label=Memoria>Memoria</a>
<button class="btn btn-menu order-2 d-block d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasDoks aria-controls=offcanvasDoks aria-label="Open main menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button><div class="offcanvas offcanvas-end border-0 py-lg-1" tabindex=-1 id=offcanvasDoks data-bs-backdrop=true aria-labelledby=offcanvasDoksLabel><div class="header-bar d-lg-none"></div><div class="offcanvas-header d-lg-none"><h2 class="h5 offcanvas-title ps-2" id=offcanvasDoksLabel><a class=text-dark href=/>Memoria</a></h2><button type=button class="btn-close text-reset me-2" data-bs-dismiss=offcanvas aria-label="Close main menu"></button></div><div class="offcanvas-body p-4 p-lg-0"><ul class="nav flex-column flex-lg-row align-items-lg-center mt-2 mt-lg-0 ms-lg-2 me-lg-auto"><li class=nav-item><a class="nav-link ps-0 py-1 active" href=/docs/overview/introduction/>Docs</a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=/tutorial/quick-start>Tutorial</a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=/api/overview/>API</a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=/python/overview/>Python</a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=/subprojects/overview/>Subprojects</a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=https://github.com/victor-smirnov/memoria/issues>Issues</a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=https://github.com/victor-smirnov/memoria/discussions>Discussions</a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=https://github.com/victor-smirnov/memoria/wiki>Releases</a></li></ul><hr class="text-black-50 my-4 d-lg-none"><form class="doks-search position-relative flex-grow-1 ms-lg-auto me-lg-2"><input id=search class="form-control is-search" type=search placeholder aria-label autocomplete=off><div id=suggestions class="shadow bg-white rounded d-none"></div></form><hr class="text-black-50 my-4 d-lg-none"><ul class="nav flex-column flex-lg-row"><li class=nav-item><a class="nav-link social-link" href=https://github.com/victor-smirnov/memoria><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><small class="ms-2 d-lg-none">GitHub</small></a></li></ul></div></div></nav></header><div class=container-xxl><aside class=doks-sidebar><nav id=doks-docs-nav class="collapse d-lg-none" aria-label="Tertiary navigation"><h3 class="h6 text-uppercase mb-2">Overview</h3><ul class=list-unstyled><li><a class=docs-link href=/docs/overview/introduction/>Introduction to Memoria</a></li><li><a class=docs-link href=/docs/overview/definitions/>Basic Definitions</a></li><li><a class=docs-link href=/docs/overview/whyc++/>Why C++</a></li><li><a class=docs-link href=/docs/overview/hardware-accel/>Hardware Acceleration in Memoria</a></li><li><a class=docs-link href=/docs/overview/qt_creator_instructions/>QT Creator Instructions</a></li><li><a class=docs-link href=/docs/overview/faq/>FAQ</a></li></ul><h3 class="h6 text-uppercase mb-2">Data Zoo</h3><ul class=list-unstyled><li><a class=docs-link href=/docs/data-zoo/overview/>Core Data Structures -- Overview</a></li><li><a class=docs-link href=/docs/data-zoo/partial-sum-tree/>Partial Sums Tree</a></li><li><a class=docs-link href=/docs/data-zoo/searchable-seq/>Searchable Sequence</a></li><li><a class=docs-link href=/docs/data-zoo/compressed-symbol-seq/>Compressed Symbol Sequence</a></li><li><a class=docs-link href=/docs/data-zoo/hierarchical-table/>Hierarchical Table</a></li><li><a class=docs-link href=/docs/data-zoo/louds-tree/>Level Order Unary Degree Sequence (LOUDS)</a></li><li><a class="docs-link active" href=/docs/data-zoo/wavelet-tree/>Multiary Wavelet Trees</a></li><li><a class=docs-link href=/docs/data-zoo/mutistream-tree/>Mutistream Balanced Tree</a></li><li><a class=docs-link href=/docs/data-zoo/packed-allocator/>Packed Allocator</a></li><li><a class=docs-link href=/docs/data-zoo/associative-memory-1/>Associative Memory (Part 1)</a></li><li><a class=docs-link href=/docs/data-zoo/associative-memory-2/>Associative Memory (Part 2)</a></li></ul><h3 class="h6 text-uppercase mb-2">Storage Engines</h3><ul class=list-unstyled><li><a class=docs-link href=/docs/storage/overview/>Storage Engines Overview</a></li><li><a class=docs-link href=/docs/storage/memory-store/>Memory Store</a></li><li><a class=docs-link href=/docs/storage/swmr-store/>SWMR Store</a></li><li><a class=docs-link href=/docs/storage/overlay-store/>Overlay Store</a></li></ul><h3 class="h6 text-uppercase mb-2">Runtime Environment</h3><h3 class="h6 text-uppercase mb-2">Linked Data & SDN</h3><h3 class="h6 text-uppercase mb-2">Digital Philosophy</h3><ul class=list-unstyled><li><a class=docs-link href=/docs/d-phil/intro/>Philosophy of Memoria - Intro</a></li><li><a class=docs-link href=/docs/d-phil/ai/>Memoria and Artificial Intelligence</a></li></ul><h3 class="h6 text-uppercase mb-2">Memoria Build Tool</h3><ul class=list-unstyled><li><a class=docs-link href=/docs/mbt/overview/>MBT Overview</a></li></ul><h3 class="h6 text-uppercase mb-2">Testing Framework</h3><ul class=list-unstyled><li><a class=docs-link href=/docs/tests/overview/>Tests -- Overview</a></li></ul><h3 class="h6 text-uppercase mb-2">Datascope</h3><ul class=list-unstyled><li><a class=docs-link href=/docs/datascope/overview/>Datascope Overview</a></li></ul><h3 class="h6 text-uppercase mb-2">Misc</h3></nav></aside></div><div class="wrap container-xxl" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar docs-sidebar-top d-none d-lg-block"><nav class=docs-links aria-label="Main navigation"><h3 class="h6 text-uppercase mb-2">Overview</h3><ul class=list-unstyled><li><a class=docs-link href=/docs/overview/introduction/>Introduction to Memoria</a></li><li><a class=docs-link href=/docs/overview/definitions/>Basic Definitions</a></li><li><a class=docs-link href=/docs/overview/whyc++/>Why C++</a></li><li><a class=docs-link href=/docs/overview/hardware-accel/>Hardware Acceleration in Memoria</a></li><li><a class=docs-link href=/docs/overview/qt_creator_instructions/>QT Creator Instructions</a></li><li><a class=docs-link href=/docs/overview/faq/>FAQ</a></li></ul><h3 class="h6 text-uppercase mb-2">Data Zoo</h3><ul class=list-unstyled><li><a class=docs-link href=/docs/data-zoo/overview/>Core Data Structures -- Overview</a></li><li><a class=docs-link href=/docs/data-zoo/partial-sum-tree/>Partial Sums Tree</a></li><li><a class=docs-link href=/docs/data-zoo/searchable-seq/>Searchable Sequence</a></li><li><a class=docs-link href=/docs/data-zoo/compressed-symbol-seq/>Compressed Symbol Sequence</a></li><li><a class=docs-link href=/docs/data-zoo/hierarchical-table/>Hierarchical Table</a></li><li><a class=docs-link href=/docs/data-zoo/louds-tree/>Level Order Unary Degree Sequence (LOUDS)</a></li><li><a class="docs-link active" href=/docs/data-zoo/wavelet-tree/>Multiary Wavelet Trees</a></li><li><a class=docs-link href=/docs/data-zoo/mutistream-tree/>Mutistream Balanced Tree</a></li><li><a class=docs-link href=/docs/data-zoo/packed-allocator/>Packed Allocator</a></li><li><a class=docs-link href=/docs/data-zoo/associative-memory-1/>Associative Memory (Part 1)</a></li><li><a class=docs-link href=/docs/data-zoo/associative-memory-2/>Associative Memory (Part 2)</a></li></ul><h3 class="h6 text-uppercase mb-2">Storage Engines</h3><ul class=list-unstyled><li><a class=docs-link href=/docs/storage/overview/>Storage Engines Overview</a></li><li><a class=docs-link href=/docs/storage/memory-store/>Memory Store</a></li><li><a class=docs-link href=/docs/storage/swmr-store/>SWMR Store</a></li><li><a class=docs-link href=/docs/storage/overlay-store/>Overlay Store</a></li></ul><h3 class="h6 text-uppercase mb-2">Runtime Environment</h3><h3 class="h6 text-uppercase mb-2">Linked Data & SDN</h3><h3 class="h6 text-uppercase mb-2">Digital Philosophy</h3><ul class=list-unstyled><li><a class=docs-link href=/docs/d-phil/intro/>Philosophy of Memoria - Intro</a></li><li><a class=docs-link href=/docs/d-phil/ai/>Memoria and Artificial Intelligence</a></li></ul><h3 class="h6 text-uppercase mb-2">Memoria Build Tool</h3><ul class=list-unstyled><li><a class=docs-link href=/docs/mbt/overview/>MBT Overview</a></li></ul><h3 class="h6 text-uppercase mb-2">Testing Framework</h3><ul class=list-unstyled><li><a class=docs-link href=/docs/tests/overview/>Tests -- Overview</a></li></ul><h3 class="h6 text-uppercase mb-2">Datascope</h3><ul class=list-unstyled><li><a class=docs-link href=/docs/datascope/overview/>Datascope Overview</a></li></ul><h3 class="h6 text-uppercase mb-2">Misc</h3></nav></div><nav class="docs-toc docs-toc-top d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=d-xl-none><button class="btn btn-outline-primary btn-sm doks-toc-toggle collapsed" type=button data-bs-toggle=collapse data-bs-target=#onThisPage aria-controls=doks-docs-nav aria-expanded=false aria-label="Toggle On this page navigation">
<span></span>
<span><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-expand" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Expand</title><polyline points="7 13 12 18 17 13"/><polyline points="7 6 12 11 17 6"/></svg><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-collapse" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Collapse</title><polyline points="17 11 12 6 7 11"/><polyline points="17 18 12 13 7 18"/></svg></span></button><div class=collapse id=onThisPage><div class="card card-body mt-3 py-1"><div class=page-links><nav id=TableOfContents><ul><li><a href=#wavelet-tree-structure>Wavelet Tree Structure</a></li><li><a href=#insertion-and-access>Insertion and Access</a></li><li><a href=#rank>Rank</a></li><li><a href=#select>Select</a></li><li><a href=#implementations>Implementations</a></li></ul></nav></div></div></div></div><div class="page-links d-none d-xl-block"><h3></h3><nav id=TableOfContents><ul><li><a href=#wavelet-tree-structure>Wavelet Tree Structure</a></li><li><a href=#insertion-and-access>Insertion and Access</a></li><li><a href=#rank>Rank</a></li><li><a href=#select>Select</a></li><li><a href=#implementations>Implementations</a></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl"><h1>Multiary Wavelet Trees</h1><p class=lead></p><nav class=d-xl-none aria-label="Quaternary navigation"><div class=d-xl-none><button class="btn btn-outline-primary btn-sm doks-toc-toggle collapsed" type=button data-bs-toggle=collapse data-bs-target=#onThisPage aria-controls=doks-docs-nav aria-expanded=false aria-label="Toggle On this page navigation">
<span></span>
<span><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-expand" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Expand</title><polyline points="7 13 12 18 17 13"/><polyline points="7 6 12 11 17 6"/></svg><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" class="doks doks-collapse" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Collapse</title><polyline points="17 11 12 6 7 11"/><polyline points="17 18 12 13 7 18"/></svg></span></button><div class=collapse id=onThisPage><div class="card card-body mt-3 py-1"><div class=page-links><nav id=TableOfContents><ul><li><a href=#wavelet-tree-structure>Wavelet Tree Structure</a></li><li><a href=#insertion-and-access>Insertion and Access</a></li><li><a href=#rank>Rank</a></li><li><a href=#select>Select</a></li><li><a href=#implementations>Implementations</a></li></ul></nav></div></div></div></div><div class="page-links d-none d-xl-block"><h3></h3><nav id=TableOfContents><ul><li><a href=#wavelet-tree-structure>Wavelet Tree Structure</a></li><li><a href=#insertion-and-access>Insertion and Access</a></li><li><a href=#rank>Rank</a></li><li><a href=#select>Select</a></li><li><a href=#implementations>Implementations</a></li></ul></nav></div></nav><p>Wavelet trees (WT) are data succinct rank/select dictionaries for large alphabets with many <a href=http://arxiv.org/abs/1011.4532>practical applications</a>. There is a good <a href=http://alexbowe.com/wavelet-trees/>explanation</a> of what binary wavelet trees are and how they work. They provide rank() and select() over symbol sequences ($N$ symbols) drawn from arbitrary fixed-size alphabets ($K$ symbols) in $O(log(N) * log(K))$ operations, where logarithms are on the base of 2. Therefore, for large alphabets, $log(K)$ is quite a big value that leads to big hidden constants in practical implementations of the binary WT.</p><p>In order to improve runtime efficiency of wavelet trees we have to lower this constant. And one of the way here is to use multiary cardinal trees instead of binary ones. In this case, for $M$-ary cardinal tree we will have $log(M)$ speedup factor over binary trees (tree height is $log(M)$-times smaller).</p><h2 id=wavelet-tree-structure>Wavelet Tree Structure <a href=#wavelet-tree-structure class=anchor aria-hidden=true>#</a></h2><p>Let we have a sequence of integers, say, 54.03.12.21.47.03.17.54.22.51 drawn from 6-bit alphabet. The following figure shows 4-ary wavelet tree for this sequence. Such WT has $6/log_2(4) = 3$ levels.</p><p>First we need to represent our sequence in a different format. Our WT is 4-ary and has 3 layers. We need to &ldquo;split&rdquo; the sequence in 3 layers horizontally where symbols of each layer are drawn from 2-bit alphabet. In other words, we need to recode our sequence from base of 10 to base of 4, and then write numbers vertically:</p><figure><img src=multiary_wavelet_tree.svg></figure><p>Note that this is just a logical operation, it doesn&rsquo;t require any transformation of the sequence itself.</p><p>Our WT is a 4-ary cardinal tree, each node has from 0 to 4 children. Each child represents one symbol from the layer&rsquo;s alphabet. Note that in general case it isn&rsquo;t necessary to draw all layers from the same alphabet, but it simplifies implementation.</p><p>In order to build WT, perform the following steps:</p><ol><li>Assign top layer (Layer 2) of the sequence to the root node of WT.</li><li>For each symbol of Layer 1 put it to the subsequence of the node with the cardinal label matched with corresponding symbol from the same position in the Layer 2.</li><li>Repeat step (2) for symbols at Layer 0 but now select appropriate child at Level 1 of the tree, using pair of symbols from the same positions at Layer 1 and Layer 2 of the sequence.</li></ol><p>Check the figure for details. Symbols in the WT and the sequence are colored to simplify understanding of symbols&rsquo; distribution.</p><p>Note that for an alphabet with K symbols, multiary WT has up to K leafs that can be very significant number. But for most practical cases this number is moderate. The larger number of distinct symbols in the sequence, the bigger tree is. Dynamic LOUDS with associated cardinality labels is used to code structure of WT.</p><p>Also, it is not necessary to keep empty nodes in the tree (they are shown in gray on the figure).</p><h2 id=insertion-and-access>Insertion and Access <a href=#insertion-and-access class=anchor aria-hidden=true>#</a></h2><p>To insert a value into WT we need:</p><ol><li>find the path from root to leaf for inserted values, insert tree nodes if necessary;</li><li>find correct position in the node&rsquo;s subsequence to insert current symbol.</li></ol><p>The path in the wavelet tree is determined by &ldquo;layered&rdquo; representation if inserted symbol. Computation of insertion position is a bit tricky.</p><p>Let we insert the value of 37 into position 7. Layered representation of 37 is &ldquo;211&rdquo;.</p><ol><li>Level 2. Insert &ldquo;2&rdquo; into position 7 of root node&rsquo;s subsequence of WT.</li><li>Level 1. Next child is &ldquo;2&rdquo;. Insertion position for &ldquo;1&rdquo; is <code>rank(7 + 1, 2) - 1 = rank(8, 2) - 1 = 1</code> computed in the parent node&rsquo;s sequence for this child.</li><li>Level 0. Next child is &ldquo;1&rdquo;, create it. Repeat the procedure for Layer 1. Insertion position for &ldquo;1&rdquo; is <code>rank(1 + 1, 1) - 1 = rank(2, 1) - 1 = 0</code> computed in the parent node&rsquo;s sequence for this child.</li></ol><p>See the following figure for details:</p><figure><img src=multiary_wavelet_tree_insert.svg></figure><p>Access is similar, but instead of to insert a symbol to a node&rsquo;s subsequence, take the symbol form it and use it to select next child.</p><h2 id=rank>Rank <a href=#rank class=anchor aria-hidden=true>#</a></h2><p>To compute rank(position, symbol) we need:</p><ol><li>find the leaf in WT for the symbol;</li><li>find position in the leaf to compute the final rank.</li></ol><figure><img src=multiary_wavelet_tree_rank.svg></figure><h2 id=select>Select <a href=#select class=anchor aria-hidden=true>#</a></h2><p>Computation of select(rank, symbol) is different. If rank() is computed top-down, then select() is computed bottom-up.</p><p>Let we need to select position of the 2nd 3 in the original sequence. Layered representation for 3 is &ldquo;003&rdquo;.</p><ol><li>Find the leaf in WT for the given symbol.</li><li>Perform <code>select(2, "3") = Pos0</code> on the leaf&rsquo;s sequence.</li><li>Walk up to parent for his leaf. Perform <code>select(Pos0 + 1, "0") = Pos1</code>.</li><li>Step up to the parent node (the root). Perform <code>select(Pos1 + 1, "0") = Pos</code>. This is the final result.</li></ol><p>Check the following figure for details:</p><figure><img src=multiary_wavelet_tree_select.svg></figure><h2 id=implementations>Implementations <a href=#implementations class=anchor aria-hidden=true>#</a></h2><p>In Memoria, Multiary wavelet tree consists of four distinct data structures.</p><ol><li>LOUDS to store wavelet tree structure.</li><li>Tree-ordered sequence of cardinal labels for tree nodes.</li><li>Tree-ordered sequence of sizes for tree node&rsquo;s sub-sequences.</li><li>Tree-ordered sequence of node&rsquo;s symbols.</li></ol><p>The first three structures are implemented as single <a href=/docs/data-zoo/louds-tree>Labeled Tree</a> with two labels. The first one is cardinality of the node in its parent. The second one is size of node&rsquo;s subsequence.</p><p>The fourth data structure is a separate <a href=/docs/data-zoo/searchable-seq>Searchable Sequence</a> for small sized alphabets.</p><p>Memoria has two different implementations of WT algorithm. The first one is dynamic WT that provides access/insert/select/rank operations performing in O(log <em>N</em>) time.</p><p>The second one has all those four data structures implemented with <a href=Memory_Allocation>Packed Allocator</a> placed in a single raw memory block of limited size. This implementation has fast access/select/rank operations but slow insert operation with O(<em>N</em>) time complexity.</p><p>Currently Memoria provides only 256-ary wavelet tree for 32-bit sequences. Other configurations will be provided in upcoming releases of the framework.</p><div class="page-footer-meta d-flex flex-column flex-md-row justify-content-between"></div><div class="docs-navigation d-flex justify-content-between"><a href=/docs/data-zoo/louds-tree/><div class="card my-1"><div class="card-body py-2">&larr; Level Order Unary Degree Sequence (LOUDS)</div></div></a><a class=ms-auto href=/docs/data-zoo/mutistream-tree/><div class="card my-1"><div class="card-body py-2">Mutistream Balanced Tree &rarr;</div></div></a></div></main></div></div></div><footer class="footer text-muted"><div class=container-xxl><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item>Powered by <a href=https://www.github.com/>Github</a>, <a href=https://gohugo.io/>Hugo</a>, and <a href=https://getdoks.org/>Doks</a></li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline><li class=list-inline-item><a href=/privacy-policy/>Privacy</a></li></ul></div></div></div></footer><script src=/js/bootstrap.min.f06fe6dc0efc9ee1e806021a0c338278256ecf163b547e8e8769fe60b0a1c0d505782852616ca4e1ff6a719eb8fc954e1d26031b8ab3ca71fb9d9998081b319e.js integrity="sha512-8G/m3A78nuHoBgIaDDOCeCVuzxY7VH6Oh2n+YLChwNUFeChSYWyk4f9qcZ64/JVOHSYDG4qzynH7nZmYCBsxng==" crossorigin=anonymous defer></script>
<script src=/js/highlight.min.349dda7f776056c3f39bc8ccb2eeab63bafd33d052a7266441e0912a4ad60fe0932e116b570cf3b263f7b944035ea6076fb02ee3b541df9fa4a48327b3b2314a.js integrity="sha512-NJ3af3dgVsPzm8jMsu6rY7r9M9BSpyZkQeCRKkrWD+CTLhFrVwzzsmP3uUQDXqYHb7Au47VB35+kpIMns7IxSg==" crossorigin=anonymous defer></script>
<script src=/js/vendor/katex/dist/katex.min.8370e08d29f784ff7c9a902e9acd0e13dbcc29df754e3b6169e0243fddd6efb28a8c3f22d1f82cb26e83f1bb2bf9f5923c696f7dad0e219d8617071e5b45ee15.js integrity="sha512-g3DgjSn3hP98mpAums0OE9vMKd91TjthaeAkP93W77KKjD8i0fgssm6D8bsr+fWSPGlvfa0OIZ2GFwceW0XuFQ==" crossorigin=anonymous defer></script>
<script src=/js/vendor/katex/dist/contrib/auto-render.min.17afcd53ae964f755803834d912cea7b9c8581cd7ab706ddf37fc95ae96365dd6e45f2083d19b63ead2d842388f769d174b4866fff4ddefb85bcbb7a4bba8434.js integrity="sha512-F6/NU66WT3VYA4NNkSzqe5yFgc16twbd83/JWuljZd1uRfIIPRm2Pq0thCOI92nRdLSGb/9N3vuFvLt6S7qENA==" crossorigin=anonymous defer></script>
<script src=/main.min.f4fc9672b82291a008c0e098e13b1cf76efef8389cf4ecfacd957f72a374aac24f8fcd030f4982efbf7ba73dbc434fa95bfa2ae5f78d156d7c269f97c9ef020d.js integrity="sha512-9PyWcrgikaAIwOCY4Tsc927++Dic9Oz6zZV/cqN0qsJPj80DD0mC7797pz28Q0+pW/oq5feNFW18Jp+Xye8CDQ==" crossorigin=anonymous defer></script>
<script src=https://memoria-framework.dev/index.min.58fe3aacc82c707b37a3645ba51a94a2d1400a153b95e2890fb5dda3bb79df0176ae8074d0e017edec4767df990ece151ff81ca58a86e292846beff6d66b9162.js integrity="sha512-WP46rMgscHs3o2RbpRqUotFAChU7leKJD7Xdo7t53wF2roB00OAX7exHZ9+ZDs4VH/gcpYqG4pKEa+/21muRYg==" crossorigin=anonymous defer></script></body></html>